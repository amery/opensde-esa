# --- SDE-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
#
# Filename: target/esa/build-initramfs.in
# Copyright (C) 2012 The OpenSDE Project
#
# More information can be found in the files COPYING and README.
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; version 2 of the License. A copy of the
# GNU General Public License can be found in the file COPYING.
# --- SDE-COPYRIGHT-NOTE-END ---

initramfs_install_pattern() {
	local pkg_name="$1"
	shift

	case "$pkg_name" in
	uclibc|gcc|binutils|libtool|e2fsprogs)
		# dynamic libraries only
		echo "-n -e 's/\.so\(\.[0-9]\+\)*$/&/p'"
		;;
	*)
		# default pattern
		echo "$@"
	esac
}

initramfs_install() {
	local pkg_name="$1" sandbox="$2" rootfs="$3"
	local x=
	shift 3

	case "$pkg_name" in
	autoconf|automake|flex|gmp|\
	linux-header|mpc|mpfr)
		# skip
		;;
	e2fsprogs)
		for x in e2fsck blkid; do
			cp "$sandbox/sbin/$x" "$rootfs/sbin/"
		done
		for x in ext2 ext3 ext4; do
			ln -s e2fsck "$rootfs/sbin/fsck.$x"
		done

		# and then the libs
		return 0
		;;
	*)
		# pass the ball to initramfs_install_pattern
		return 0
		;;
	esac
	return 1
}

